<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ChatGPT Mini Project</title>

    <!-- FontAwesome icon -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />

    <style>
      /* ================== GLOBAL STYLE ================== */
      body {
        font-family: Arial, sans-serif;
        background: #f4f4f6;
        margin: 0;
      }

      /* ================== CHAT BUBBLE ================== */
      .chat-bubble {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #0084ff;
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 32px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        transition: 0.2s;
      }
      .chat-bubble:hover {
        transform: scale(1.1);
      }

      /* ================== CHAT BOX ================== */
      .chat-box {
        width: 350px;
        height: 460px;
        background: white;
        position: fixed;
        bottom: 100px;
        right: 24px;
        border-radius: 14px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        display: none;
        flex-direction: column;
        overflow: hidden;
        z-index: 9999;
      }

      /* HEADER */
      .chat-header {
        background: #0084ff;
        color: white;
        padding: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .chat-header img {
        width: 32px;
        height: 32px;
        border-radius: 50%;
      }
      .chat-header button {
        margin-left: auto;
        border: none;
        background: transparent;
        font-size: 22px;
        color: white;
        cursor: pointer;
      }

      /* CONTENT */
      .chat-content {
        flex: 1;
        overflow-y: auto;
        padding: 12px;
        background: #f5f6f7;
      }
      .msg {
        max-width: 80%;
        padding: 10px 14px;
        border-radius: 12px;
        margin-bottom: 12px;
        line-height: 1.4;
        font-size: 15px;
      }
      .msg.user {
        background: #0084ff;
        color: white;
        margin-left: auto;
      }
      .msg.bot {
        background: #e4e6eb;
        color: #333;
      }

      /* ================== TYPING EFFECT ================== */
      .typing-bubble {
        display: none;
        background: #e4e6eb;
        padding: 8px 14px;
        border-radius: 12px;
        width: fit-content;
        margin-bottom: 12px;
        display: flex;
        gap: 6px;
      }
      .typing-bubble .dot {
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: #777;
        animation: typing 1s infinite ease-in-out;
      }
      .typing-bubble .dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-bubble .dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typing {
        0% {
          opacity: 0.3;
          transform: translateY(0);
        }
        50% {
          opacity: 1;
          transform: translateY(-4px);
        }
        100% {
          opacity: 0.3;
          transform: translateY(0);
        }
      }

      /* INPUT */
      .chat-input {
        display: flex;
        border-top: 1px solid #ddd;
      }
      .chat-input input {
        flex: 1;
        padding: 10px;
        border: none;
        font-size: 15px;
        outline: none;
      }
      .chat-input button {
        width: 70px;
        border: none;
        background: #0084ff;
        color: white;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <!-- CHAT BUBBLE -->
    <div class="chat-bubble" id="chatToggle">
      <i class="fa-brands fa-facebook-messenger"></i>
    </div>

    <!-- CHAT BOX -->
    <div class="chat-box" id="chatBox">
      <div class="chat-header">
        <img src="https://i.imgur.com/4ZQZ4bC.png" />
        <span>ChatGPT Mini</span>
        <button id="closeChat">&times;</button>
      </div>

      <div class="chat-content">
        <div class="msg bot">
          Chào bạn! Mình là ChatGPT Mini chạy trên website. Bạn muốn hỏi gì nè?
        </div>

        <!-- Typing indicator -->
        <div class="typing-bubble" id="typingBubble">
          <div class="dot"></div>
          <div class="dot"></div>
          <div class="dot"></div>
        </div>
      </div>

      <div class="chat-input">
        <input type="text" id="msgInput" placeholder="Nhập tin nhắn..." />
        <button id="sendMsg">Gửi</button>
      </div>
    </div>

    <!-- ================== JAVASCRIPT ================== -->
    <script>
      // ====== API KEY ======
      const GEMINI_API_KEY = "AIzaSyD6mvgxctWr9Zh5tYzzRG0eyxgUQbb1880";

      // ====== DOM ELEMENTS ======
      const chatToggle = document.getElementById("chatToggle");
      const chatBox = document.getElementById("chatBox");
      const closeChat = document.getElementById("closeChat");
      const msgInput = document.getElementById("msgInput");
      const sendMsg = document.getElementById("sendMsg");
      const chatContent = document.querySelector(".chat-content");
      const typingBubble = document.getElementById("typingBubble");

      // ====== UI ACTIONS ======
      chatToggle.addEventListener(
        "click",
        () => (chatBox.style.display = "flex")
      );
      closeChat.addEventListener(
        "click",
        () => (chatBox.style.display = "none")
      );

      function addUserMessage(text) {
        const div = document.createElement("div");
        div.className = "msg user";
        div.textContent = text;
        chatContent.appendChild(div);
        chatContent.scrollTop = chatContent.scrollHeight;
      }

      function addBotMessage(text) {
        const div = document.createElement("div");
        div.className = "msg bot";
        div.innerHTML = text;
        chatContent.appendChild(div);
        chatContent.scrollTop = chatContent.scrollHeight;
      }

      function showTyping() {
        typingBubble.style.display = "flex";
        chatContent.appendChild(typingBubble);
        chatContent.scrollTop = chatContent.scrollHeight;
      }

      function hideTyping() {
        typingBubble.style.display = "none";
      }

      // ====== CALL GEMINI API ======
      async function callChatGPTAPI(prompt) {
        try {
          showTyping();

          const response = await fetch(
            "https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash-latest:generateContent?key=" +
              GEMINI_API_KEY,
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                contents: [{ parts: [{ text: prompt }] }],
              }),
            }
          );

          const data = await response.json();
          console.log("Gemini trả về:", data);

          hideTyping();

          if (!data.candidates || !data.candidates[0]) {
            return (
              "⚠️ Lỗi API: " + (data.error?.message || "Không rõ nguyên nhân.")
            );
          }

          return data.candidates[0].content.parts[0].text;
        } catch (err) {
          hideTyping();
          return "⚠️ Lỗi hệ thống: " + err.message;
        }
      }

      // ====== SEND MESSAGE ======
      sendMsg.addEventListener("click", async () => {
        const text = msgInput.value.trim();
        if (!text) return;

        addUserMessage(text);
        msgInput.value = "";

        const reply = await callChatGPTAPI(text);
        addBotMessage(reply);
      });

      // Enter = Gửi tin nhắn
      msgInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") sendMsg.click();
      });
    </script>
  </body>
</html>
