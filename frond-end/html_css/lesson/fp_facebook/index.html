<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mimi N3 Unit 1 ‚Äì Quiz Max (JP ‚áÜ VI)</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        background: #f4f5fb;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
      }

      .app {
        width: 100%;
        max-width: 780px;
        background: #ffffff;
        border-radius: 18px;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.18);
        padding: 18px 20px 20px;
      }

      .app-header {
        margin-bottom: 10px;
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 7px;
      }

      .title {
        font-size: 1.2rem;
        font-weight: 700;
        color: #111827;
      }

      .subtitle {
        font-size: 0.86rem;
        color: #6b7280;
        margin-top: 2px;
      }

      .top-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 6px;
        font-size: 0.85rem;
        color: #4b5563;
      }

      .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        background: #eef2ff;
        color: #4f46e5;
        font-size: 0.78rem;
        font-weight: 600;
      }

      .mode-pill {
        background: #ecfeff;
        color: #0f766e;
        margin-left: 4px;
      }

      .session-pill {
        background: #fef9c3;
        color: #854d0e;
        margin-left: 4px;
      }

      .direction-toggle,
      .session-toggle {
        display: inline-flex;
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
      }

      .direction-btn,
      .size-btn {
        padding: 3px 10px;
        font-size: 0.78rem;
        border: none;
        background: transparent;
        cursor: pointer;
        color: #6b7280;
        font-weight: 600;
        white-space: nowrap;
      }

      .direction-btn.active,
      .size-btn.active {
        background: #4f46e5;
        color: #ffffff;
      }

      .progress-bar-wrapper {
        margin-top: 8px;
        width: 100%;
        height: 6px;
        border-radius: 999px;
        background: #e5e7eb;
        overflow: hidden;
      }

      .progress-bar {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #4f46e5, #22c55e);
        transition: width 0.2s ease;
      }

      .question-card {
        margin-top: 14px;
        padding: 14px 14px 16px;
        border-radius: 14px;
        background: #f9fafb;
        border: 1px solid #e5e7eb;
      }

      .label {
        font-size: 0.8rem;
        font-weight: 600;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        margin-bottom: 4px;
      }

      .word {
        font-size: 1.25rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 4px;
        line-height: 1.35;
      }

      .kana {
        font-size: 0.96rem;
        color: #4b5563;
        margin-bottom: 4px;
      }

      .index {
        font-size: 0.8rem;
        color: #6b7280;
      }

      .options {
        margin-top: 14px;
        display: grid;
        gap: 8px;
      }

      .option-btn {
        width: 100%;
        text-align: left;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
        padding: 8px 12px;
        background: #ffffff;
        cursor: pointer;
        font-size: 0.94rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: background 0.15s ease, box-shadow 0.15s ease,
          transform 0.04s ease, border-color 0.12s ease;
      }

      .option-btn span {
        pointer-events: none;
      }

      .option-index {
        font-size: 0.8rem;
        font-weight: 600;
        color: #9ca3af;
        margin-right: 8px;
      }

      .option-main {
        flex: 1;
        color: #111827;
      }

      .option-sub {
        font-size: 0.8rem;
        color: #6b7280;
        margin-left: 4px;
      }

      .option-btn:hover:not(:disabled) {
        background: #f3f4ff;
        box-shadow: 0 2px 6px rgba(79, 70, 229, 0.18);
        border-color: #c7d2fe;
        transform: translateY(-1px);
      }

      .option-btn.correct {
        background: #ecfdf3;
        border-color: #22c55e;
        color: #166534;
      }

      .option-btn.wrong {
        background: #fef2f2;
        border-color: #f97373;
        color: #991b1b;
      }

      .option-btn:disabled {
        cursor: default;
        opacity: 0.9;
        box-shadow: none;
        transform: none;
      }

      .feedback {
        margin-top: 12px;
        font-size: 0.9rem;
      }

      .feedback-text {
        font-weight: 600;
        margin-bottom: 4px;
      }

      .feedback-text.correct {
        color: #15803d;
      }

      .feedback-text.wrong {
        color: #b91c1c;
      }

      .example-jp {
        font-size: 0.9rem;
        color: #111827;
        margin-bottom: 2px;
      }

      .example-vi {
        font-size: 0.86rem;
        color: #4b5563;
      }

      .summary {
        font-size: 0.85rem;
        color: #4b5563;
        margin-top: 6px;
      }

      .controls {
        margin-top: 14px;
        display: flex;
        justify-content: space-between;
        gap: 8px;
        align-items: center;
        flex-wrap: wrap;
      }

      .btn {
        border-radius: 999px;
        padding: 7px 13px;
        border: none;
        cursor: pointer;
        font-size: 0.86rem;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: background 0.15s ease, box-shadow 0.15s ease,
          transform 0.04s ease, opacity 0.12s ease;
        white-space: nowrap;
      }

      .btn-primary {
        background: #4f46e5;
        color: #ffffff;
        box-shadow: 0 4px 10px rgba(79, 70, 229, 0.35);
      }

      .btn-primary:hover:not(:disabled) {
        background: #4338ca;
        box-shadow: 0 5px 12px rgba(79, 70, 229, 0.55);
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: #e5e7eb;
        color: #374151;
      }

      .btn-secondary:hover:not(:disabled) {
        background: #d1d5db;
        transform: translateY(-1px);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
        transform: none;
      }

      .footer-text {
        font-size: 0.72rem;
        color: #9ca3af;
        text-align: right;
        margin-top: 4px;
      }

      /* Stats box */
      .stats-box {
        margin-top: 14px;
        padding: 12px 12px 10px;
        border-radius: 14px;
        background: #fefefe;
        border: 1px dashed #e5e7eb;
      }

      .stats-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #111827;
        margin-bottom: 6px;
      }

      .stats-subtitle {
        font-size: 0.78rem;
        color: #6b7280;
        margin-bottom: 6px;
      }

      .stats-empty {
        font-size: 0.8rem;
        color: #9ca3af;
        font-style: italic;
      }

      .stats-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
      }

      .stats-table th,
      .stats-table td {
        padding: 4px 6px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
      }

      .stats-table th {
        font-weight: 600;
        color: #4b5563;
        background: #f9fafb;
      }

      .stats-tag {
        font-size: 0.7rem;
        padding: 1px 4px;
        border-radius: 999px;
        background: #fee2e2;
        color: #b91c1c;
        margin-left: 4px;
      }

      @media (max-width: 640px) {
        .app {
          padding: 14px 11px 14px;
          border-radius: 14px;
        }
        .title {
          font-size: 1.05rem;
        }
        .word {
          font-size: 1.05rem;
        }
        .options {
          gap: 6px;
        }
        .direction-btn,
        .size-btn {
          padding: 3px 7px;
        }
        .stats-table th,
        .stats-table td {
          padding: 3px 4px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <header class="app-header">
        <div class="title">Mimi Kara Oboeru N3 ‚Äì Unit 1</div>
        <div class="subtitle">
          Quiz 50 danh t·ª´ A ¬∑ Luy·ªán hai chi·ªÅu JP ‚áÜ VI ¬∑ Ch·ªçn 10/20/50 c√¢u ¬∑ L∆∞u
          & th·ªëng k√™ c√¢u sai
        </div>

        <div class="top-row">
          <div>
            <span class="pill" id="progressPill">C√¢u 1 / 50</span>
            <span class="pill mode-pill" id="modePill">Ch·∫ø ƒë·ªô: To√†n b·ªô</span>
            <span class="pill session-pill" id="sessionPill"
              >Phi√™n: 50 c√¢u</span
            >
          </div>
          <div>
            <span
              >ƒêi·ªÉm: <span id="scoreText">0</span> /
              <span id="answeredText">0</span></span
            >
            &nbsp;¬∑&nbsp;
            <span>ƒê√∫ng: <span id="percentText">0</span>%</span>
          </div>
        </div>

        <div class="top-row" style="margin-top: 6px">
          <div class="direction-toggle">
            <button
              class="direction-btn active"
              data-direction="vi-jp"
              id="btnViJp"
            >
              VI ‚Üí JP
            </button>
            <button class="direction-btn" data-direction="jp-vi" id="btnJpVi">
              JP ‚Üí VI
            </button>
          </div>
          <div class="session-toggle">
            <button class="size-btn" data-size="10" id="btnSize10">
              10 c√¢u
            </button>
            <button class="size-btn" data-size="20" id="btnSize20">
              20 c√¢u
            </button>
            <button class="size-btn active" data-size="50" id="btnSize50">
              50 c√¢u
            </button>
          </div>
        </div>

        <div class="top-row" style="margin-top: 4px">
          <div style="font-size: 0.78rem; color: #6b7280">
            G·ª£i √Ω: ph√≠m <b>A,B,C,D</b> ƒë·ªÉ ch·ªçn ƒë√°p √°n ¬∑ <b>Enter</b> sang c√¢u
            ti·∫øp.
          </div>
        </div>

        <div class="progress-bar-wrapper">
          <div class="progress-bar" id="progressBar"></div>
        </div>
      </header>

      <section class="question-card">
        <div class="label" id="promptLabel">Nghƒ©a ti·∫øng Vi·ªát</div>
        <div class="word" id="wordText">nam gi·ªõi</div>
        <div class="kana" id="kanaText">Ch·ªçn t·ª´ ti·∫øng Nh·∫≠t t∆∞∆°ng ·ª©ng.</div>
        <div class="index" id="indexText">
          Ch·∫ø ƒë·ªô: To√†n b·ªô 50 t·ª´ ¬∑ C√¢u 1 / 50
        </div>

        <div class="options" id="optionsContainer"></div>

        <div class="feedback" id="feedbackBox" style="display: none">
          <div class="feedback-text" id="feedbackText"></div>
          <div class="example-jp" id="exampleJp"></div>
          <div class="example-vi" id="exampleVi"></div>
          <div class="summary" id="summaryText"></div>
        </div>

        <div class="controls">
          <button class="btn btn-primary" id="nextBtn" disabled>
            ‚û° C√¢u ti·∫øp
          </button>
          <button class="btn btn-secondary" id="reviewBtn" disabled>
            üß™ √în l·∫°i c√¢u sai
          </button>
          <button class="btn btn-secondary" id="restartBtn">
            üîÅ L√†m l·∫°i (phi√™n hi·ªán t·∫°i)
          </button>
        </div>
      </section>

      <section class="stats-box" id="statsBox">
        <div class="stats-title">Top t·ª´ sai nhi·ªÅu nh·∫•t</div>
        <div class="stats-subtitle">
          Th·ªëng k√™ t·ªïng h·ª£p cho t·∫•t c·∫£ ch·∫ø ƒë·ªô & phi√™n. D·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u tr√™n
          tr√¨nh duy·ªát c·ªßa b·∫°n.
        </div>
        <div id="statsContent" class="stats-content">
          <!-- s·∫Ω ƒë∆∞·ª£c fill b·∫±ng JS -->
        </div>
      </section>

      <div class="footer-text">
        ¬© Nguy·ªÖn VƒÉn Ti·∫øn &amp; ChatGPT ‚Äì Mimi N3 Unit 1 Quiz Max
      </div>
    </div>

    <script>
      // ====== DATA 50 T·ª™ V·ª∞NG ======
      const vocabList = [
        {
          id: 1,
          kanji: "Áî∑ÊÄß",
          kana: "„Å†„Çì„Åõ„ÅÑ",
          meaning: "nam gi·ªõi",
          jp: "„Åù„ÅÆÁî∑ÊÄß„ÅØÂÖàÁîü„Åß„Åô„ÄÇ",
          vi: "Ng∆∞·ªùi ƒë√†n √¥ng ƒë√≥ l√† gi√°o vi√™n.",
        },
        {
          id: 2,
          kanji: "Â•≥ÊÄß",
          kana: "„Åò„Çá„Åõ„ÅÑ",
          meaning: "ph·ª• n·ªØ",
          jp: "„ÅÇ„ÅÆÂ•≥ÊÄß„ÅØ„Åç„Çå„ÅÑ„Åß„Åô„ÄÇ",
          vi: "C√¥ g√°i kia ƒë·∫πp.",
        },
        {
          id: 3,
          kanji: "È´òÈΩ¢",
          kana: "„Åì„ÅÜ„Çå„ÅÑ",
          meaning: "cao tu·ªïi",
          jp: "È´òÈΩ¢„ÅÆ‰∫∫„Å´Â∏≠„Çí„ÇÜ„Åö„Çä„Åæ„Åô„ÄÇ",
          vi: "Nh∆∞·ªùng gh·∫ø cho ng∆∞·ªùi cao tu·ªïi.",
        },
        {
          id: 4,
          kanji: "Âπ¥‰∏ä",
          kana: "„Å®„Åó„ÅÜ„Åà",
          meaning: "ng∆∞·ªùi l·ªõn tu·ªïi h∆°n",
          jp: "ÂΩº„ÅØÁßÅ„Çà„ÇäÂπ¥‰∏ä„Åß„Åô„ÄÇ",
          vi: "Anh ·∫•y l·ªõn tu·ªïi h∆°n t√¥i.",
        },
        {
          id: 5,
          kanji: "ÁõÆ‰∏ä",
          kana: "„ÇÅ„ÅÜ„Åà",
          meaning: "c·∫•p tr√™n",
          jp: "ÁõÆ‰∏ä„ÅÆ‰∫∫„Å´„ÅØ‰∏ÅÂØß„Å´Ë©±„Åó„Åæ„Åô„ÄÇ",
          vi: "N√≥i chuy·ªán l·ªãch s·ª± v·ªõi ng∆∞·ªùi c·∫•p tr√™n.",
        },
        {
          id: 6,
          kanji: "ÂÖàËº©",
          kana: "„Åõ„Çì„Å±„ÅÑ",
          meaning: "ti·ªÅn b·ªëi",
          jp: "ÂÖàËº©„Å´‰ªï‰∫ã„ÇíÊïô„Åà„Å¶„ÇÇ„Çâ„ÅÑ„Åæ„Åó„Åü„ÄÇ",
          vi: "T√¥i ƒë∆∞·ª£c ƒë√†n anh ch·ªâ vi·ªác.",
        },
        {
          id: 7,
          kanji: "ÂæåËº©",
          kana: "„Åì„ÅÜ„ÅØ„ÅÑ",
          meaning: "h·∫≠u b·ªëi",
          jp: "ÂæåËº©„ÇíÊâã‰ºù„Å£„Å¶„ÅÇ„Åí„Åü„ÄÇ",
          vi: "T√¥i gi√∫p ƒë·ª° ƒë√†n em.",
        },
        {
          id: 8,
          kanji: "‰∏äÂè∏",
          kana: "„Åò„Çá„ÅÜ„Åó",
          meaning: "c·∫•p tr√™n, s·∫øp",
          jp: "‰∏äÂè∏„Å´Áõ∏Ë´á„Åó„Åæ„Åô„ÄÇ",
          vi: "T√¥i h·ªèi √Ω ki·∫øn s·∫øp.",
        },
        {
          id: 9,
          kanji: "Áõ∏Êâã",
          kana: "„ÅÇ„ÅÑ„Å¶",
          meaning: "ƒë·ªëi ph∆∞∆°ng",
          jp: "Áõ∏Êâã„ÅÆÁõÆ„ÇíË¶ã„Å¶Ë©±„Åô„ÄÇ",
          vi: "H√£y nh√¨n v√†o m·∫Øt ƒë·ªëi ph∆∞∆°ng khi n√≥i.",
        },
        {
          id: 10,
          kanji: "Áü•„ÇäÂêà„ÅÑ",
          kana: "„Åó„Çä„ÅÇ„ÅÑ",
          meaning: "ng∆∞·ªùi quen",
          jp: "ÂΩº„ÅØ‰ºöÁ§æ„ÅÆÁü•„ÇäÂêà„ÅÑ„Åß„Åô„ÄÇ",
          vi: "Anh ·∫•y l√† ng∆∞·ªùi quen ·ªü c√¥ng ty.",
        },
        {
          id: 11,
          kanji: "Âèã‰∫∫",
          kana: "„ÇÜ„ÅÜ„Åò„Çì",
          meaning: "b·∫°n th√¢n",
          jp: "Âèã‰∫∫„Å®ÊóÖË°å„Åó„Åæ„Åô„ÄÇ",
          vi: "T√¥i ƒëi du l·ªãch v·ªõi b·∫°n th√¢n.",
        },
        {
          id: 12,
          kanji: "‰ª≤",
          kana: "„Å™„Åã",
          meaning: "m·ªëi quan h·ªá",
          jp: "‰∫å‰∫∫„ÅØ‰ª≤„Åå„ÅÑ„ÅÑ„ÄÇ",
          vi: "Hai ng∆∞·ªùi h·ªç r·∫•t th√¢n.",
        },
        {
          id: 13,
          kanji: "ÁîüÂπ¥ÊúàÊó•",
          kana: "„Åõ„ÅÑ„Å≠„Çì„Åå„Å£„Å¥",
          meaning: "ng√†y th√°ng nƒÉm sinh",
          jp: "ÁîüÂπ¥ÊúàÊó•„ÇíÊõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
          vi: "H√£y vi·∫øt ng√†y th√°ng nƒÉm sinh.",
        },
        {
          id: 14,
          kanji: "Ë™ïÁîü",
          kana: "„Åü„Çì„Åò„Çá„ÅÜ",
          meaning: "sinh ra",
          jp: "Â≠ê‰æõ„ÅÆË™ïÁîü„ÇíÁ•ù„ÅÑ„Åæ„Åô„ÄÇ",
          vi: "Ch√∫c m·ª´ng s·ª± ra ƒë·ªùi c·ªßa em b√©.",
        },
        {
          id: 15,
          kanji: "Âπ¥",
          kana: "„Å®„Åó",
          meaning: "nƒÉm, tu·ªïi",
          jp: "Âπ¥„Çí„Å®„Å£„Å¶„ÇÇÂÖÉÊ∞ó„Åß„Åô„ÄÇ",
          vi: "D√π l·ªõn tu·ªïi v·∫´n kh·ªèe.",
        },
        {
          id: 16,
          kanji: "Âá∫Ë∫´",
          kana: "„Åó„ÇÖ„Å£„Åó„Çì",
          meaning: "xu·∫•t th√¢n",
          jp: "ÁßÅ„ÅØ„Éè„Éé„Ç§Âá∫Ë∫´„Åß„Åô„ÄÇ",
          vi: "T√¥i ƒë·∫øn t·ª´ H√† N·ªôi.",
        },
        {
          id: 17,
          kanji: "ÊïÖÈÉ∑",
          kana: "„Åì„Åç„Çá„ÅÜ",
          meaning: "qu√™ h∆∞∆°ng",
          jp: "‰πÖ„Åó„Å∂„Çä„Å´ÊïÖÈÉ∑„Å∏Â∏∞„Å£„Åü„ÄÇ",
          vi: "L√¢u r·ªìi t√¥i m·ªõi v·ªÅ qu√™.",
        },
        {
          id: 18,
          kanji: "ÊàêÈï∑",
          kana: "„Åõ„ÅÑ„Å°„Çá„ÅÜ",
          meaning: "tr∆∞·ªüng th√†nh, ph√°t tri·ªÉn",
          jp: "Â≠ê‰æõ„ÅØÊó©„ÅèÊàêÈï∑„Åó„Åæ„Åô„ÄÇ",
          vi: "Tr·∫ª con l·ªõn nhanh.",
        },
        {
          id: 19,
          kanji: "Êàê‰∫∫",
          kana: "„Åõ„ÅÑ„Åò„Çì",
          meaning: "ng∆∞·ªùi tr∆∞·ªüng th√†nh",
          jp: "ÂΩº„ÅØ‰ªäÂπ¥Êàê‰∫∫„Åó„Åü„ÄÇ",
          vi: "Anh ·∫•y tr∆∞·ªüng th√†nh nƒÉm nay.",
        },
        {
          id: 20,
          kanji: "ÂêàÊ†º",
          kana: "„Åî„ÅÜ„Åã„Åè",
          meaning: "ƒë·ªó, ƒë·∫≠u",
          jp: "Ë©¶È®ì„Å´ÂêàÊ†º„Åó„Åü„ÄÇ",
          vi: "T√¥i ƒë·ªó k·ª≥ thi.",
        },
        {
          id: 21,
          kanji: "ÈÄ≤Â≠¶",
          kana: "„Åó„Çì„Åå„Åè",
          meaning: "h·ªçc l√™n cao",
          jp: "Â§ßÂ≠¶„Å´ÈÄ≤Â≠¶„Åó„Åæ„Åô„ÄÇ",
          vi: "T√¥i h·ªçc l√™n ƒë·∫°i h·ªçc.",
        },
        {
          id: 22,
          kanji: "ÈÄÄÂ≠¶",
          kana: "„Åü„ÅÑ„Åå„Åè",
          meaning: "th√¥i h·ªçc",
          jp: "ÂΩº„ÅØÁóÖÊ∞ó„ÅßÈÄÄÂ≠¶„Åó„Åü„ÄÇ",
          vi: "Anh ·∫•y th√¥i h·ªçc v√¨ b·ªánh.",
        },
        {
          id: 23,
          kanji: "Â∞±ËÅ∑",
          kana: "„Åó„ÇÖ„ÅÜ„Åó„Çá„Åè",
          meaning: "t√¨m vi·ªác, ƒëi l√†m",
          jp: "Â§ßÊâã‰ºöÁ§æ„Å´Â∞±ËÅ∑„Åó„Åü„ÄÇ",
          vi: "T√¥i xin ƒë∆∞·ª£c vi·ªác ·ªü c√¥ng ty l·ªõn.",
        },
        {
          id: 24,
          kanji: "ÈÄÄËÅ∑",
          kana: "„Åü„ÅÑ„Åó„Çá„Åè",
          meaning: "ngh·ªâ vi·ªác",
          jp: "Áà∂„ÅØ‰ªäÂπ¥ÈÄÄËÅ∑„Åô„Çã„ÄÇ",
          vi: "Ba t√¥i ngh·ªâ vi·ªác nƒÉm nay.",
        },
        {
          id: 25,
          kanji: "Â§±Ê•≠",
          kana: "„Åó„Å§„Åé„Çá„ÅÜ",
          meaning: "th·∫•t nghi·ªáp",
          jp: "Â§±Ê•≠„Åó„Å¶Âõ∞„Å£„Å¶„ÅÑ„Çã„ÄÇ",
          vi: "T√¥i th·∫•t nghi·ªáp v√† g·∫∑p kh√≥ khƒÉn.",
        },
        {
          id: 26,
          kanji: "ÊÆãÊ•≠",
          kana: "„Åñ„Çì„Åé„Çá„ÅÜ",
          meaning: "l√†m th√™m",
          jp: "‰ªäÊó•„ÅØÊÆãÊ•≠„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
          vi: "H√¥m nay t√¥i ph·∫£i l√†m th√™m.",
        },
        {
          id: 27,
          kanji: "ÁîüÊ¥ª",
          kana: "„Åõ„ÅÑ„Åã„Å§",
          meaning: "cu·ªôc s·ªëng",
          jp: "Êó•Êú¨„Åß„ÅÆÁîüÊ¥ª„Å´ÊÖ£„Çå„Åü„ÄÇ",
          vi: "T√¥i quen v·ªõi cu·ªôc s·ªëng ·ªü Nh·∫≠t.",
        },
        {
          id: 28,
          kanji: "ÈÄöÂã§",
          kana: "„Å§„ÅÜ„Åç„Çì",
          meaning: "ƒëi l√†m",
          jp: "ÊØéÊó•ÈõªËªä„ÅßÈÄöÂã§„Åó„Å¶„ÅÑ„Çã„ÄÇ",
          vi: "H·∫±ng ng√†y t√¥i ƒëi l√†m b·∫±ng t√†u.",
        },
        {
          id: 29,
          kanji: "Â≠¶Ê≠¥",
          kana: "„Åå„Åè„Çå„Åç",
          meaning: "h·ªçc v·∫•n",
          jp: "Â≠¶Ê≠¥„Çà„ÇäÂÆüÂäõ„ÅåÂ§ß‰∫ã„Å†„ÄÇ",
          vi: "NƒÉng l·ª±c quan tr·ªçng h∆°n h·ªçc v·∫•n.",
        },
        {
          id: 30,
          kanji: "Áµ¶Êñô",
          kana: "„Åç„ÇÖ„ÅÜ„Çä„Çá„ÅÜ",
          meaning: "l∆∞∆°ng",
          jp: "‰ªäÊúà„ÅÆÁµ¶Êñô„Çí„ÇÇ„Çâ„Å£„Åü„ÄÇ",
          vi: "T√¥i ƒë√£ nh·∫≠n l∆∞∆°ng th√°ng n√†y.",
        },
        {
          id: 31,
          kanji: "Èù¢Êé•",
          kana: "„ÇÅ„Çì„Åõ„Å§",
          meaning: "ph·ªèng v·∫•n",
          jp: "‰ªäÊó•„ÅØÈù¢Êé•„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
          vi: "H√¥m nay t√¥i c√≥ ph·ªèng v·∫•n.",
        },
        {
          id: 32,
          kanji: "‰ºëÊÜ©",
          kana: "„Åç„ÇÖ„ÅÜ„Åë„ÅÑ",
          meaning: "ngh·ªâ gi·∫£i lao",
          jp: "Â∞ë„Åó‰ºëÊÜ©„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ",
          vi: "Ngh·ªâ m·ªôt ch√∫t nh√©.",
        },
        {
          id: 33,
          kanji: "Ë¶≥ÂÖâ",
          kana: "„Åã„Çì„Åì„ÅÜ",
          meaning: "tham quan",
          jp: "‰∫¨ÈÉΩ„ÇíË¶≥ÂÖâ„Åó„Åü„ÅÑ„ÄÇ",
          vi: "T√¥i mu·ªën tham quan Kyoto.",
        },
        {
          id: 34,
          kanji: "Â∏∞ÂõΩ",
          kana: "„Åç„Åì„Åè",
          meaning: "v·ªÅ n∆∞·ªõc",
          jp: "Êù•ÊúàÂ∏∞ÂõΩ„Åó„Åæ„Åô„ÄÇ",
          vi: "Th√°ng sau t√¥i v·ªÅ n∆∞·ªõc.",
        },
        {
          id: 35,
          kanji: "Â∏∞ÁúÅ",
          kana: "„Åç„Åõ„ÅÑ",
          meaning: "v·ªÅ qu√™",
          jp: "Ê≠£Êúà„Å´Â∏∞ÁúÅ„Åó„Åæ„Åô„ÄÇ",
          vi: "T·∫øt t√¥i v·ªÅ qu√™.",
        },
        {
          id: 36,
          kanji: "Â∏∞ÂÆÖ",
          kana: "„Åç„Åü„Åè",
          meaning: "v·ªÅ nh√†",
          jp: "ÊØéÊó•9ÊôÇ„Å´Â∏∞ÂÆÖ„Åô„Çã„ÄÇ",
          vi: "H·∫±ng ng√†y t√¥i v·ªÅ nh√† l√∫c 9 gi·ªù.",
        },
        {
          id: 37,
          kanji: "ÂèÇÂä†",
          kana: "„Åï„Çì„Åã",
          meaning: "tham gia",
          jp: "„Ç§„Éô„É≥„Éà„Å´ÂèÇÂä†„Åó„Åæ„Åô„ÄÇ",
          vi: "T√¥i tham gia s·ª± ki·ªán.",
        },
        {
          id: 38,
          kanji: "Âá∫Â∏≠",
          kana: "„Åó„ÇÖ„Å£„Åõ„Åç",
          meaning: "c√≥ m·∫∑t, tham d·ª±",
          jp: "‰ºöË≠∞„Å´Âá∫Â∏≠„Åó„Åü„ÄÇ",
          vi: "T√¥i c√≥ m·∫∑t trong cu·ªôc h·ªçp.",
        },
        {
          id: 39,
          kanji: "Ê¨†Â∏≠",
          kana: "„Åë„Å£„Åõ„Åç",
          meaning: "v·∫Øng m·∫∑t",
          jp: "‰ªäÊó•„ÅØÊ¨†Â∏≠„Åó„Åæ„Åô„ÄÇ",
          vi: "H√¥m nay t√¥i v·∫Øng m·∫∑t.",
        },
        {
          id: 40,
          kanji: "ÈÅÖÂàª",
          kana: "„Å°„Åì„Åè",
          meaning: "ƒëi tr·ªÖ",
          jp: "ÊéàÊ•≠„Å´ÈÅÖÂàª„Åó„Åü„ÄÇ",
          vi: "T√¥i ƒëi h·ªçc tr·ªÖ.",
        },
        {
          id: 41,
          kanji: "ÂåñÁ≤ß",
          kana: "„Åë„Åó„Çá„ÅÜ",
          meaning: "trang ƒëi·ªÉm",
          jp: "ÊØéÊúùÂåñÁ≤ß„Çí„Åó„Åæ„Åô„ÄÇ",
          vi: "T√¥i trang ƒëi·ªÉm m·ªói s√°ng.",
        },
        {
          id: 42,
          kanji: "Ë®àÁÆó",
          kana: "„Åë„ÅÑ„Åï„Çì",
          meaning: "t√≠nh to√°n",
          jp: "ÊñôÈáë„ÇíË®àÁÆó„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
          vi: "H√£y t√≠nh ti·ªÅn gi√∫p t√¥i.",
        },
        {
          id: 43,
          kanji: "Ë®àÁîª",
          kana: "„Åë„ÅÑ„Åã„Åè",
          meaning: "k·∫ø ho·∫°ch",
          jp: "ÊóÖË°å„ÅÆË®àÁîª„ÇíÁ´ã„Å¶„Çã„ÄÇ",
          vi: "L·∫≠p k·∫ø ho·∫°ch du l·ªãch.",
        },
        {
          id: 44,
          kanji: "ÊàêÂäü",
          kana: "„Åõ„ÅÑ„Åì„ÅÜ",
          meaning: "th√†nh c√¥ng",
          jp: "Ë®àÁîª„ÅØÊàêÂäü„Åó„Åü„ÄÇ",
          vi: "K·∫ø ho·∫°ch ƒë√£ th√†nh c√¥ng.",
        },
        {
          id: 45,
          kanji: "Â§±Êïó",
          kana: "„Åó„Å£„Å±„ÅÑ",
          meaning: "th·∫•t b·∫°i",
          jp: "„ÉÜ„Çπ„Éà„ÅßÂ§±Êïó„Åó„Åü„ÄÇ",
          vi: "T√¥i th·∫•t b·∫°i trong b√†i ki·ªÉm tra.",
        },
        {
          id: 46,
          kanji: "Ê∫ñÂÇô",
          kana: "„Åò„ÇÖ„Çì„Å≥",
          meaning: "chu·∫©n b·ªã",
          jp: "‰ºöË≠∞„ÅÆÊ∫ñÂÇô„Çí„Åô„Çã„ÄÇ",
          vi: "Chu·∫©n b·ªã cho cu·ªôc h·ªçp.",
        },
        {
          id: 47,
          kanji: "Êï¥ÁêÜ",
          kana: "„Åõ„ÅÑ„Çä",
          meaning: "s·∫Øp x·∫øp",
          jp: "Êú∫„ÇíÊï¥ÁêÜ„Åó„Åü„ÄÇ",
          vi: "T√¥i s·∫Øp x·∫øp b√†n l√†m vi·ªác.",
        },
        {
          id: 48,
          kanji: "Ê≥®Êñá",
          kana: "„Å°„ÇÖ„ÅÜ„ÇÇ„Çì",
          meaning: "g·ªçi m√≥n, ƒë·∫∑t h√†ng",
          jp: "„Ç≥„Éº„Éí„Éº„ÇíÊ≥®Êñá„Åó„Åü„ÄÇ",
          vi: "T√¥i g·ªçi c√† ph√™.",
        },
        {
          id: 49,
          kanji: "Ë≤ØÈáë",
          kana: "„Å°„Çá„Åç„Çì",
          meaning: "ti·∫øt ki·ªám ti·ªÅn",
          jp: "ÊØéÊúàË≤ØÈáë„Åó„Å¶„ÅÑ„Çã„ÄÇ",
          vi: "T√¥i ti·∫øt ki·ªám m·ªói th√°ng.",
        },
        {
          id: 50,
          kanji: "ÂæπÂ§ú",
          kana: "„Å¶„Å§„ÇÑ",
          meaning: "th·ª©c khuya, th·ª©c tr·∫Øng ƒë√™m",
          jp: "Êò®Êó•„ÅØÂæπÂ§ú„Åó„Åü„ÄÇ",
          vi: "T√¥i ƒë√£ th·ª©c tr·∫Øng ƒë√™m h√¥m qua.",
        },
      ];

      // ====== DOM ELEMENTS ======
      const wordText = document.getElementById("wordText");
      const kanaText = document.getElementById("kanaText");
      const promptLabel = document.getElementById("promptLabel");
      const indexText = document.getElementById("indexText");
      const progressPill = document.getElementById("progressPill");
      const modePill = document.getElementById("modePill");
      const sessionPill = document.getElementById("sessionPill");
      const progressBar = document.getElementById("progressBar");
      const optionsContainer = document.getElementById("optionsContainer");
      const feedbackBox = document.getElementById("feedbackBox");
      const feedbackText = document.getElementById("feedbackText");
      const exampleJp = document.getElementById("exampleJp");
      const exampleVi = document.getElementById("exampleVi");
      const summaryText = document.getElementById("summaryText");
      const nextBtn = document.getElementById("nextBtn");
      const restartBtn = document.getElementById("restartBtn");
      const reviewBtn = document.getElementById("reviewBtn");
      const scoreText = document.getElementById("scoreText");
      const answeredText = document.getElementById("answeredText");
      const percentText = document.getElementById("percentText");
      const btnViJp = document.getElementById("btnViJp");
      const btnJpVi = document.getElementById("btnJpVi");
      const btnSize10 = document.getElementById("btnSize10");
      const btnSize20 = document.getElementById("btnSize20");
      const btnSize50 = document.getElementById("btnSize50");
      const statsContent = document.getElementById("statsContent");

      // ====== STATE ======
      let direction = "vi-jp"; // "vi-jp" or "jp-vi"
      let mode = "all"; // "all" or "review"
      let sessionSize = 50; // 10, 20, 50
      let mainOrder = [];
      let currentOrder = [];
      let currentIndex = 0;
      let score = 0;
      let answeredCount = 0;
      let questionLocked = false;

      // wrongSets[direction] = Set index t·ª´ v·ª±ng b·ªã sai
      const wrongSets = {
        "vi-jp": new Set(),
        "jp-vi": new Set(),
      };

      // th·ªëng k√™ t·ªïng cho t·ª´ng t·ª´
      // perVocabStats[i] = {attempts, wrongs}
      let perVocabStats = new Array(vocabList.length)
        .fill(0)
        .map(() => ({ attempts: 0, wrongs: 0 }));

      const STORAGE_KEYS = {
        "vi-jp": "mimi_unit1_wrong_vi_jp",
        "jp-vi": "mimi_unit1_wrong_jp_vi",
      };
      const STATS_KEY = "mimi_unit1_stats_v1";

      // ====== HELPERS ======
      function shuffle(array) {
        const arr = [...array];
        for (let i = arr.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
      }

      function saveWrongSets() {
        for (const dir of ["vi-jp", "jp-vi"]) {
          const arr = Array.from(wrongSets[dir]);
          try {
            localStorage.setItem(STORAGE_KEYS[dir], JSON.stringify(arr));
          } catch (e) {}
        }
      }

      function loadWrongSets() {
        for (const dir of ["vi-jp", "jp-vi"]) {
          try {
            const raw = localStorage.getItem(STORAGE_KEYS[dir]);
            if (raw) {
              const arr = JSON.parse(raw);
              wrongSets[dir] = new Set(arr);
            }
          } catch (e) {}
        }
      }

      function saveStats() {
        try {
          localStorage.setItem(STATS_KEY, JSON.stringify(perVocabStats));
        } catch (e) {}
      }

      function loadStats() {
        try {
          const raw = localStorage.getItem(STATS_KEY);
          if (raw) {
            const arr = JSON.parse(raw);
            if (Array.isArray(arr) && arr.length === vocabList.length) {
              perVocabStats = arr;
            }
          }
        } catch (e) {}
      }

      function updateReviewButtonState() {
        reviewBtn.disabled = wrongSets[direction].size === 0;
      }

      function updateScoreUI() {
        scoreText.textContent = String(score);
        answeredText.textContent = String(answeredCount);
        const pct =
          answeredCount === 0 ? 0 : Math.round((score / answeredCount) * 100);
        percentText.textContent = String(pct);
      }

      function updateProgressBar() {
        const total = currentOrder.length || 1;
        const pct = (currentIndex / total) * 100;
        progressBar.style.width = pct + "%";
      }

      function updateSessionPill() {
        if (mode === "review") {
          sessionPill.textContent = "Phi√™n: √în c√¢u sai";
        } else {
          sessionPill.textContent = `Phi√™n: ${sessionSize} c√¢u`;
        }
      }

      // ====== STATS UI ======
      function refreshStatsUI() {
        const items = perVocabStats
          .map((st, idx) => ({ idx, ...st }))
          .filter((x) => x.wrongs > 0)
          .sort((a, b) => {
            if (b.wrongs !== a.wrongs) return b.wrongs - a.wrongs;
            return b.attempts - a.attempts;
          })
          .slice(0, 5);

        if (items.length === 0) {
          statsContent.innerHTML =
            '<div class="stats-empty">Ch∆∞a c√≥ d·ªØ li·ªáu l·ªói. H√£y l√†m quiz ƒë·ªÉ xem t·ª´ n√†o hay sai nh√©.</div>';
          return;
        }

        let html =
          '<table class="stats-table"><thead><tr><th>#</th><th>T·ª´ ti·∫øng Nh·∫≠t</th><th>Nghƒ©a ti·∫øng Vi·ªát</th><th>Sai/T·ªïng</th><th>T·ªâ l·ªá sai</th></tr></thead><tbody>';
        items.forEach((it, rank) => {
          const v = vocabList[it.idx];
          const rate =
            it.attempts === 0 ? 0 : Math.round((it.wrongs / it.attempts) * 100);
          html += `<tr>
          <td>${rank + 1}</td>
          <td>${v.kanji}Ôºà${v.kana}Ôºâ</td>
          <td>${v.meaning}</td>
          <td>${it.wrongs} / ${it.attempts}</td>
          <td>${rate}%${
            rate >= 50 ? '<span class="stats-tag">c·∫ßn √¥n</span>' : ""
          }</td>
        </tr>`;
        });
        html += "</tbody></table>";
        statsContent.innerHTML = html;
      }

      // ====== QUIZ LOGIC ======
      function initQuiz(resetWrong = false) {
        if (resetWrong) {
          wrongSets["vi-jp"].clear();
          wrongSets["jp-vi"].clear();
          saveWrongSets();
        }
        mode = "all";
        modePill.textContent = "Ch·∫ø ƒë·ªô: To√†n b·ªô";
        updateSessionPill();

        const allIdx = vocabList.map((_, idx) => idx);
        const shuffled = shuffle(allIdx);
        const size = Math.min(sessionSize, shuffled.length);
        mainOrder = shuffled.slice(0, size);

        currentOrder = [...mainOrder];
        currentIndex = 0;
        score = 0;
        answeredCount = 0;
        updateScoreUI();
        updateReviewButtonState();
        loadQuestion();
      }

      function setDirection(newDirection) {
        if (direction === newDirection) return;
        direction = newDirection;

        // toggle button UI
        if (direction === "vi-jp") {
          btnViJp.classList.add("active");
          btnJpVi.classList.remove("active");
        } else {
          btnJpVi.classList.add("active");
          btnViJp.classList.remove("active");
        }

        initQuiz(false);
      }

      function setSessionSize(newSize) {
        sessionSize = newSize;
        btnSize10.classList.toggle("active", sessionSize === 10);
        btnSize20.classList.toggle("active", sessionSize === 20);
        btnSize50.classList.toggle("active", sessionSize === 50);
        initQuiz(false);
      }

      function getPromptAndOptions(vocabIndex) {
        const vocab = vocabList[vocabIndex];

        if (direction === "vi-jp") {
          const prompt = vocab.meaning;
          const subtitle = "Ch·ªçn t·ª´ ti·∫øng Nh·∫≠t t∆∞∆°ng ·ª©ng v·ªõi nghƒ©a tr√™n.";
          const label = "Nghƒ©a ti·∫øng Vi·ªát";

          const optionsIdx = [vocabIndex];
          while (optionsIdx.length < 4) {
            const cand = Math.floor(Math.random() * vocabList.length);
            if (!optionsIdx.includes(cand)) optionsIdx.push(cand);
          }
          const shuffled = shuffle(optionsIdx).map((idx) => ({
            index: idx,
            main: vocabList[idx].kanji,
            sub: vocabList[idx].kana,
          }));

          return { prompt, subtitle, label, options: shuffled };
        } else {
          const prompt = vocab.kanji + "Ôºà" + vocab.kana + "Ôºâ";
          const subtitle = "Ch·ªçn nghƒ©a ti·∫øng Vi·ªát ƒë√∫ng.";
          const label = "T·ª´ ti·∫øng Nh·∫≠t";

          const optionsIdx = [vocabIndex];
          while (optionsIdx.length < 4) {
            const cand = Math.floor(Math.random() * vocabList.length);
            if (!optionsIdx.includes(cand)) optionsIdx.push(cand);
          }
          const shuffled = shuffle(optionsIdx).map((idx) => ({
            index: idx,
            main: vocabList[idx].meaning,
            sub: "",
          }));

          return { prompt, subtitle, label, options: shuffled };
        }
      }

      function loadQuestion() {
        feedbackBox.style.display = "none";
        feedbackText.textContent = "";
        exampleJp.textContent = "";
        exampleVi.textContent = "";
        summaryText.textContent = "";
        nextBtn.disabled = true;
        questionLocked = false;
        updateProgressBar();

        if (currentIndex >= currentOrder.length) {
          const textEnd =
            mode === "review"
              ? "ƒê√£ √¥n xong t·∫•t c·∫£ c√¢u sai trong ch·∫ø ƒë·ªô n√†y."
              : "Ho√†n th√†nh to√†n b·ªô c√¢u trong phi√™n hi·ªán t·∫°i.";
          wordText.textContent = textEnd;
          kanaText.textContent =
            wrongSets[direction].size > 0
              ? "B·∫°n c√≥ th·ªÉ b·∫•m ‚Äú√în l·∫°i c√¢u sai‚Äù ƒë·ªÉ luy·ªán ri√™ng c√°c t·ª´ hay nh·∫ßm."
              : "Kh√¥ng c√≤n c√¢u sai n√†o cho ch·∫ø ƒë·ªô n√†y. Qu√° ƒë·ªânh!";
          indexText.textContent =
            mode === "review"
              ? "Ch·∫ø ƒë·ªô: √în l·∫°i c√¢u sai"
              : `Ch·∫ø ƒë·ªô: To√†n b·ªô ¬∑ Phi√™n ${sessionSize} c√¢u`;

          optionsContainer.innerHTML = "";
          progressPill.textContent = "Xong ‚úî";
          summaryText.textContent =
            "T·ªïng k·∫øt phi√™n n√†y: ƒë√∫ng " +
            score +
            "/" +
            answeredCount +
            " c√¢u (" +
            percentText.textContent +
            "%).";
          feedbackBox.style.display = "block";
          return;
        }

        const vocabIndex = currentOrder[currentIndex];
        const vocab = vocabList[vocabIndex];
        const num = currentIndex + 1;

        const { prompt, subtitle, label, options } =
          getPromptAndOptions(vocabIndex);

        wordText.textContent = prompt;
        kanaText.textContent = subtitle;
        promptLabel.textContent = label;
        indexText.textContent =
          (mode === "review"
            ? "Ch·∫ø ƒë·ªô: √în l·∫°i c√¢u sai ¬∑ "
            : "Ch·∫ø ƒë·ªô: To√†n b·ªô ¬∑ ") + `C√¢u ${num} / ${currentOrder.length}`;
        progressPill.textContent = `C√¢u ${num} / ${currentOrder.length}`;

        optionsContainer.innerHTML = "";
        options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.className = "option-btn";
          btn.innerHTML = `
          <span class="option-index">${String.fromCharCode(65 + idx)}</span>
          <span class="option-main">${opt.main}</span>
          ${
            opt.sub
              ? `<span class="option-sub">(${opt.sub})</span>`
              : '<span class="option-sub"></span>'
          }
        `;
          btn.addEventListener("click", () =>
            handleAnswer(opt.index, vocabIndex)
          );
          btn.dataset.answerIndex = idx;
          optionsContainer.appendChild(btn);
        });
      }

      function handleAnswer(chosenIndex, correctIndex) {
        if (questionLocked) return;
        questionLocked = true;
        answeredCount++;

        const buttons = optionsContainer.querySelectorAll("button");
        buttons.forEach((btn) => (btn.disabled = true));

        const correctItem = vocabList[correctIndex];
        const chosenItem = vocabList[chosenIndex];

        // C·∫≠p nh·∫≠t stats t·ªïng
        perVocabStats[correctIndex].attempts++;
        let isCorrect = chosenIndex === correctIndex;
        if (!isCorrect) {
          perVocabStats[correctIndex].wrongs++;
        }
        saveStats();
        refreshStatsUI();

        // C·∫≠p nh·∫≠t wrongSets & ƒëi·ªÉm
        if (isCorrect) {
          score++;
          if (mode === "review") {
            wrongSets[direction].delete(correctIndex);
          }
        } else {
          wrongSets[direction].add(correctIndex);
        }
        saveWrongSets();
        updateReviewButtonState();
        updateScoreUI();

        // t√¥ m√†u ƒë√°p √°n
        buttons.forEach((btn) => {
          const mainText = btn.querySelector(".option-main").textContent;
          const subText = btn
            .querySelector(".option-sub")
            .textContent.replace(/[()]/g, "");
          const matchCorrect =
            mainText === correctItem.kanji || mainText === correctItem.meaning;
          const matchChosen =
            mainText === chosenItem.kanji || mainText === chosenItem.meaning;

          if (matchCorrect) {
            btn.classList.add("correct");
          } else if (matchChosen && !isCorrect) {
            btn.classList.add("wrong");
          }
        });

        feedbackBox.style.display = "block";
        if (isCorrect) {
          feedbackText.textContent = "ƒê√∫ng r·ªìi! ‚ú®";
          feedbackText.className = "feedback-text correct";
        } else {
          const rightText =
            direction === "vi-jp"
              ? `${correctItem.kanji}Ôºà${correctItem.kana}Ôºâ`
              : `${correctItem.meaning}`;
          feedbackText.textContent = `Sai r·ªìi. ƒê√°p √°n ƒë√∫ng: „Äå${rightText}„Äç`;
          feedbackText.className = "feedback-text wrong";
        }
        exampleJp.textContent = `‰æãÊñáÔºö${correctItem.jp}`;
        exampleVi.textContent = `D·ªãchÔºö${correctItem.vi}`;

        const remainingWrong = wrongSets[direction].size;
        if (remainingWrong > 0) {
          summaryText.textContent =
            "Hi·ªán c√≤n " +
            remainingWrong +
            " t·ª´ ƒëang n·∫±m trong danh s√°ch ‚Äúc√¢u sai‚Äù ·ªü ch·∫ø ƒë·ªô " +
            (direction === "vi-jp" ? "VI ‚Üí JP" : "JP ‚Üí VI") +
            ".";
        } else {
          summaryText.textContent =
            "Kh√¥ng c√≤n t·ª´ n√†o trong danh s√°ch c√¢u sai c·ªßa ch·∫ø ƒë·ªô n√†y. Tuy·ªát v·ªùi!";
        }

        nextBtn.disabled = false;
      }

      // ====== EVENT LISTENERS ======
      nextBtn.addEventListener("click", () => {
        if (currentIndex < currentOrder.length) {
          currentIndex++;
          loadQuestion();
        }
      });

      restartBtn.addEventListener("click", () => {
        // l√†m l·∫°i phi√™n hi·ªán t·∫°i (gi·ªØ direction & sessionSize)
        initQuiz(false);
      });

      reviewBtn.addEventListener("click", () => {
        const arr = Array.from(wrongSets[direction]);
        if (arr.length === 0) return;
        mode = "review";
        modePill.textContent = "Ch·∫ø ƒë·ªô: √în l·∫°i c√¢u sai";
        updateSessionPill();
        currentOrder = shuffle(arr);
        currentIndex = 0;
        score = 0;
        answeredCount = 0;
        updateScoreUI();
        loadQuestion();
      });

      btnViJp.addEventListener("click", () => setDirection("vi-jp"));
      btnJpVi.addEventListener("click", () => setDirection("jp-vi"));

      btnSize10.addEventListener("click", () => setSessionSize(10));
      btnSize20.addEventListener("click", () => setSessionSize(20));
      btnSize50.addEventListener("click", () => setSessionSize(50));

      // B·∫Øt ph√≠m A/B/C/D + Enter
      document.addEventListener("keydown", (e) => {
        const key = e.key.toLowerCase();
        const buttons = optionsContainer.querySelectorAll("button");
        if (!buttons.length) return;

        if (["a", "b", "c", "d"].includes(key)) {
          const idx = key.charCodeAt(0) - 97; // 'a' -> 0
          if (buttons[idx] && !buttons[idx].disabled) {
            buttons[idx].click();
          }
        } else if (key === "enter") {
          if (!nextBtn.disabled) {
            nextBtn.click();
          }
        }
      });

      // ====== START ======
      loadWrongSets();
      loadStats();
      refreshStatsUI();
      updateReviewButtonState();
      updateSessionPill();
      updateScoreUI();
      initQuiz(false);
    </script>
  </body>
</html>
