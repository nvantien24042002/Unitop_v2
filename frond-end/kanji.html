<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>N3 Super Quiz 2.0 ‚Äì Kanji + Compounds + Wrong Review</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      /* =============== GLOBAL =============== */
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Inter",
          sans-serif;
        background: radial-gradient(
          circle at top,
          #eef2ff 0,
          #f3f4f6 45%,
          #e5e7eb 100%
        );
        color: #111827;
      }

      .wrapper {
        max-width: 1000px;
        margin: 32px auto;
        background: #ffffff;
        padding: 24px 24px 28px;
        border-radius: 22px;
        box-shadow: 0 20px 48px rgba(15, 23, 42, 0.15);
        border: 1px solid rgba(148, 163, 184, 0.35);
      }

      h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 800;
        letter-spacing: -0.02em;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      h1 span.logo-dot {
        width: 10px;
        height: 10px;
        border-radius: 999px;
        background: linear-gradient(135deg, #6366f1, #ec4899);
        display: inline-block;
      }

      .subtitle {
        margin: 4px 0 16px;
        color: #6b7280;
        font-size: 14px;
      }

      /* =============== HEADER + SCORE + REVIEW BTN =============== */
      .header-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        flex-wrap: wrap;
        gap: 16px;
      }

      .score-box {
        font-size: 13px;
        background: #f9fafb;
        padding: 8px 14px;
        border-radius: 999px;
        border: 1px solid #e5e7eb;
      }

      .review-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: #fff7ed;
        border: 1px solid #fdba74;
        color: #b45309;
        padding: 8px 14px;
        border-radius: 999px;
        font-size: 13px;
        cursor: pointer;
        transition: 0.2s;
      }

      .review-btn:hover {
        background: #ffedd5;
      }

      /* =============== MODE SWITCH BUTTONS =============== */
      .mode-switch {
        margin: 18px 0 18px;
        background: #f9fafb;
        border-radius: 999px;
        padding: 4px;
        display: inline-flex;
        gap: 4px;
        border: 1px solid #e5e7eb;
        flex-wrap: wrap;
      }

      .mode-btn {
        border-radius: 999px;
        border: none;
        padding: 8px 12px;
        background: transparent;
        font-size: 13px;
        cursor: pointer;
        color: #4b5563;
        transition: all 0.15s ease;
      }

      .mode-btn.active {
        background: linear-gradient(135deg, #4f46e5, #6366f1);
        color: #ffffff;
        box-shadow: 0 4px 10px rgba(79, 70, 229, 0.35);
      }

      .mode-hint {
        font-size: 14px;
        color: #6b7280;
        margin-bottom: 18px;
      }

      /* =============== QUIZ LAYOUT =============== */
      #quiz-layout {
        display: grid;
        grid-template-columns: 1fr 1.3fr;
        gap: 20px;
      }
      @media (max-width: 900px) {
        #quiz-layout {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: #f9fafb;
        border-radius: 16px;
        padding: 18px;
        border: 1px solid #e5e7eb;
      }

      /* =============== QUIZ PANEL =============== */
      .kanji-display {
        font-size: 64px;
        text-align: center;
        font-weight: 700;
        margin-bottom: 6px;
      }
      .kanji-display.small-text {
        font-size: 32px;
      }

      .reading {
        text-align: center;
        color: #4b5563;
        font-size: 14px;
        margin-bottom: 10px;
      }

      .question-text {
        text-align: center;
        font-size: 15px;
        color: #374151;
        margin-bottom: 12px;
      }

      .options {
        display: grid;
        gap: 10px;
      }

      .option-btn {
        width: 100%;
        padding: 10px 14px;
        border-radius: 999px;
        background: #ffffff;
        border: 1px solid #e5e7eb;
        cursor: pointer;
        font-size: 14px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: 0.15s;
      }

      .option-btn.correct {
        background: #dcfce7;
        border-color: #16a34a;
      }
      .option-btn.wrong {
        background: #fee2e2;
        border-color: #b91c1c;
      }

      .feedback {
        font-size: 14px;
        font-weight: 600;
        margin-top: 10px;
      }
      .feedback.correct {
        color: #16a34a;
      }
      .feedback.wrong {
        color: #b91c1c;
      }

      .actions {
        margin-top: 16px;
        display: flex;
        justify-content: space-between;
      }

      .btn {
        border-radius: 999px;
        padding: 8px 14px;
        font-size: 14px;
        cursor: pointer;
      }

      .btn-primary {
        background: linear-gradient(135deg, #4f46e5, #6366f1);
        border: none;
        color: #fff;
      }

      .btn-outline {
        background: #fff;
        border: 1px solid #e5e7eb;
      }

      /* =============== INFO PANEL =============== */
      #info-panel h2 {
        margin: 0 0 8px;
        font-size: 18px;
      }

      .info-row {
        font-size: 14px;
        margin-bottom: 4px;
      }

      .info-label {
        font-weight: 600;
      }

      .compound-list {
        margin-left: 20px;
      }

      .example {
        margin-top: 10px;
        background: #e0f2fe;
        padding: 10px;
        border-radius: 10px;
      }

      .mode-pill {
        background: #e5e7eb;
        padding: 4px 10px;
        border-radius: 999px;
        display: inline-block;
        margin-bottom: 8px;
        font-size: 12px;
      }
      /* =============== DARK MODE =============== */

      body.dark {
        background: #0f172a;
        color: #e2e8f0;
      }

      body.dark .wrapper {
        background: #1e293b;
        border-color: #334155;
      }

      body.dark .card {
        background: #1e293b;
        border-color: #334155;
      }

      body.dark .mode-btn {
        color: #cbd5e1;
      }

      body.dark .mode-btn.active {
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
      }

      body.dark .score-box {
        background: #334155;
        border-color: #475569;
        color: #e2e8f0;
      }

      body.dark .review-btn {
        background: #3b2f17;
        border-color: #b7791f;
        color: #fef3c7;
      }

      body.dark .option-btn {
        background: #334155;
        border-color: #475569;
        color: #e2e8f0;
      }

      body.dark .option-btn.correct {
        background: #065f46;
        border-color: #10b981;
        color: #d1fae5;
      }

      body.dark .option-btn.wrong {
        background: #7f1d1d;
        border-color: #dc2626;
      }

      body.dark #info-panel {
        background: #1e293b;
      }

      body.dark .example {
        background: #0c4a6e;
      }

      /* Dark Mode Toggle Button */
      #dark-toggle {
        position: absolute;
        right: 20px;
        top: 20px;
        cursor: pointer;
        background: #e5e7eb;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 13px;
        border: 1px solid #cbd5e1;
      }
      body.dark #dark-toggle {
        background: #334155;
        color: #f8fafc;
        border-color: #475569;
      }
    </style>
  </head>

  <body>
    <div class="wrapper">
      <h1><span class="logo-dot"></span> N3 Super Quiz 2.0</h1>
      <button id="dark-toggle">üåô Dark Mode</button>
      <p class="subtitle">
        √în Kanji & T·ª´ gh√©p (compounds) N3 ‚Äì k√®m ch·∫ø ƒë·ªô ‚Äú√în t·ª´ sai‚Äù t·ª± ƒë·ªông l∆∞u
        khi b·∫°n tr·∫£ l·ªùi sai.
      </p>

      <!-- HEADER -->
      <div class="header-row">
        <div class="score-box">
          C√¢u: <span id="current-question">0</span> /
          <span id="total-question">0</span>
          ‚Ä¢ ƒê√∫ng: <span id="correct-count">0</span>
        </div>

        <button id="review-btn" class="review-btn">
          ‚òÖ √în t·ª´ sai (<span id="wrong-count">0</span>)
        </button>
      </div>

      <!-- MODE SWITCH -->
      <div class="mode-switch">
        <button class="mode-btn active" data-mode="kanji-meaning">
          Â≠ó Kanji ‚Üí Nghƒ©a
        </button>
        <button class="mode-btn" data-mode="compound-meaning">
          Ë™û T·ª´ gh√©p ‚Üí Nghƒ©a
        </button>
        <button class="mode-btn" data-mode="meaning-to-item">
          VI Nghƒ©a ‚Üí Kanji / Ë™û
        </button>
        <button class="mode-btn" data-mode="reading">„ÅÇ ƒê·ªçc (Kana)</button>
      </div>

      <div class="mode-hint" id="mode-hint">
        Ch·∫ø ƒë·ªô Kanji ‚Üí Nghƒ©a: Nh√¨n Kanji, ch·ªçn nghƒ©a ƒë√∫ng.
      </div>
      <!-- START SCRIPT -->
      <script>
        /* ===================== DATA KANJI G·ªêC ===================== */
        const vocabList = [
          {
            id: 1,
            type: "kanji",
            kanji: "Èßê",
            kana: "„ÉÅ„É•„Ç¶",
            onyomi: "„ÉÅ„É•„Ç¶",
            kunyomi: "",
            meaning: "ƒë·ªó xe, c∆∞ tr√∫",
            exampleJP: "ÈßêËªäÂ†¥„Å´Ëªä„ÇíÊ≠¢„ÇÅ„Çã„ÄÇ",
            exampleVI: "ƒê·ªó xe trong b√£i ƒë·ªó xe.",
            compounds: [
              { word: "ÈßêËªä", kana: "„Å°„ÇÖ„ÅÜ„Åó„ÇÉ", vi: "ƒë·ªó xe" },
              { word: "ÈßêËªäÂ†¥", kana: "„Å°„ÇÖ„ÅÜ„Åó„ÇÉ„Åò„Çá„ÅÜ", vi: "b√£i ƒë·ªó xe" },
            ],
          },
          {
            id: 2,
            type: "kanji",
            kanji: "ÁÑ°",
            kana: "„É†Ôºè„Éñ",
            onyomi: "„É†„Éª„Éñ",
            kunyomi: "„Å™„ÅÑ",
            meaning: "kh√¥ng, v√¥",
            exampleJP: "ÁÑ°ÁêÜ„Çí„Åó„Å™„ÅÑ„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ",
            exampleVI: "ƒê·ª´ng c·ªë qu√°.",
            compounds: [
              { word: "ÁÑ°‰ºë", kana: "„ÇÄ„Åç„ÇÖ„ÅÜ", vi: "kh√¥ng ngh·ªâ" },
              { word: "ÁÑ°ÁêÜÔºà„Å™Ôºâ", kana: "„ÇÄ„ÇäÔºà„Å™Ôºâ", vi: "v√¥ l√Ω, qu√° s·ª©c" },
              { word: "ÁÑ°Êñô", kana: "„ÇÄ„Çä„Çá„ÅÜ", vi: "mi·ªÖn ph√≠" },
              { word: "ÁÑ°„ÅÑ", kana: "„Å™„ÅÑ", vi: "kh√¥ng c√≥" },
            ],
          },
          {
            id: 3,
            type: "kanji",
            kanji: "Ê∫Ä",
            kana: "„Éû„É≥",
            onyomi: "„Éû„É≥",
            kunyomi: "„Åø-„Å°„Çã",
            meaning: "ƒë·∫ßy, m√£n",
            exampleJP: "ÈßêËªäÂ†¥„ÅØÊ∫ÄËªä„Åß„Åô„ÄÇ",
            exampleVI: "B√£i ƒë·ªó xe ƒë√£ ƒë·∫ßy.",
            compounds: [
              { word: "Ê∫ÄËªä", kana: "„Åæ„Çì„Åó„ÇÉ", vi: "ƒë·∫ßy xe" },
              { word: "‰∏çÊ∫ÄÔºà„Å™Ôºâ", kana: "„Åµ„Åæ„ÇìÔºà„Å™Ôºâ", vi: "b·∫•t m√£n" },
            ],
          },
          {
            id: 4,
            type: "kanji",
            kanji: "Âêë",
            kana: "„Ç≥„Ç¶",
            onyomi: "„Ç≥„Ç¶",
            kunyomi: "„ÇÄ-„ÅèÔºè„ÇÄ-„Åã„ÅÜ",
            meaning: "h∆∞·ªõng, h∆∞·ªõng v·ªÅ",
            exampleJP: "ÈßÖ„ÅÆÊñπÂêë„Å∏Âêë„Åã„ÅÜ„ÄÇ",
            exampleVI: "H∆∞·ªõng v·ªÅ ph√≠a nh√† ga.",
            compounds: [
              { word: "ÊñπÂêë", kana: "„Åª„ÅÜ„Åì„ÅÜ", vi: "ph∆∞∆°ng h∆∞·ªõng" },
              { word: "Âêë„Åã„ÅÜ", kana: "„ÇÄ„Åã„ÅÜ", vi: "h∆∞·ªõng t·ªõi" },
            ],
          },
          {
            id: 5,
            type: "kanji",
            kanji: "Á¶Å",
            kana: "„Ç≠„É≥",
            onyomi: "„Ç≠„É≥",
            kunyomi: "",
            meaning: "c·∫•m",
            exampleJP: "„Åì„Åì„ÅØÁ¶ÅÁÖô„Åß„Åô„ÄÇ",
            exampleVI: "·ªû ƒë√¢y c·∫•m h√∫t thu·ªëc.",
            compounds: [{ word: "Á¶ÅÊ≠¢", kana: "„Åç„Çì„Åó", vi: "c·∫•m ƒëo√°n" }],
          },
          {
            id: 6,
            type: "kanji",
            kanji: "Èñ¢",
            kana: "„Ç´„É≥",
            onyomi: "„Ç´„É≥",
            kunyomi: "„Åã„Åã-„Çè„Çã„Éª„Åõ„Åç",
            meaning: "li√™n quan, quan h·ªá",
            exampleJP: "„Åì„ÅÆÂïèÈ°å„Å´Èñ¢ÂøÉ„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
            exampleVI: "T√¥i c√≥ quan t√¢m ƒë·∫øn v·∫•n ƒë·ªÅ n√†y.",
            compounds: [{ word: "Èñ¢ÂøÉ", kana: "„Åã„Çì„Åó„Çì", vi: "quan t√¢m" }],
          },
          {
            id: 7,
            type: "kanji",
            kanji: "‰øÇ",
            kana: "„Ç±„Ç§",
            onyomi: "„Ç±„Ç§",
            kunyomi: "„Åã„Åã-„Çä",
            meaning: "ng∆∞·ªùi ph·ª• tr√°ch",
            exampleJP: "‰øÇ„ÅÆ‰∫∫„Å´ËÅû„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
            exampleVI: "H√£y h·ªèi ng∆∞·ªùi ph·ª• tr√°ch.",
            compounds: [
              { word: "Èñ¢‰øÇ", kana: "„Åã„Çì„Åë„ÅÑ", vi: "m·ªëi quan h·ªá, li√™n quan" },
              { word: "‰øÇ", kana: "„Åã„Åã„Çä", vi: "ng∆∞·ªùi ph·ª• tr√°ch" },
            ],
          },
          {
            id: 8,
            type: "kanji",
            kanji: "Êñ≠",
            kana: "„ÉÄ„É≥",
            onyomi: "„ÉÄ„É≥",
            kunyomi: "„Åì„Å®„Çè-„Çã",
            meaning: "t·ª´ ch·ªëi, c·∫Øt ƒë·ª©t",
            exampleJP: "ÂΩº„ÅÆ„ÅäÈ°ò„ÅÑ„ÇíÊñ≠„Å£„Åü„ÄÇ",
            exampleVI: "T√¥i ƒë√£ t·ª´ ch·ªëi l·ªùi nh·ªù v·∫£ c·ªßa anh ·∫•y.",
            compounds: [
              { word: "ÁÑ°Êñ≠", kana: "„ÇÄ„Å†„Çì", vi: "kh√¥ng xin ph√©p" },
              { word: "Êñ≠„Çã", kana: "„Åì„Å®„Çè„Çã", vi: "t·ª´ ch·ªëi" },
            ],
          },
          {
            id: 9,
            type: "kanji",
            kanji: "Ê®™",
            kana: "„É®„Ç≥",
            onyomi: "„Ç™„Ç¶",
            kunyomi: "„Çà„Åì",
            meaning: "ngang, b√™n c·∫°nh",
            exampleJP: "Ê®™Êñ≠Ê≠©ÈÅì„ÇíÊ∏°„Çã„ÄÇ",
            exampleVI: "BƒÉng qua l·ªëi bƒÉng qua ƒë∆∞·ªùng.",
            compounds: [
              { word: "Ê®™Êñ≠", kana: "„Åä„ÅÜ„Å†„Çì", vi: "bƒÉng ngang (ƒë∆∞·ªùng)" },
              { word: "Ê®™", kana: "„Çà„Åì", vi: "b√™n c·∫°nh, ngang, b√™n h√¥ng" },
            ],
          },
          {
            id: 10,
            type: "kanji",
            kanji: "Êäº",
            kana: "„Åä-„Åô",
            onyomi: "„Ç™„Ç¶",
            kunyomi: "„Åä-„ÅôÔºè„Åä-„Åï„Åà„Çã",
            meaning: "·∫•n, ƒë·∫©y",
            exampleJP: "„Éú„Çø„É≥„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
            exampleVI: "H√£y nh·∫•n n√∫t.",
            compounds: [
              { word: "Êäº„Åô", kana: "„Åä„Åô", vi: "·∫•n, nh·∫•n" },
              {
                word: "Êäº„ÅóÂÖ•„Çå",
                kana: "„Åä„Åó„ÅÑ„Çå",
                vi: "t·ªß t∆∞·ªùng, t·ªß √¢m t∆∞·ªùng",
              },
              {
                word: "Êäº„Åó„Éú„Çø„É≥Âºè",
                kana: "„Åä„Åó„Éú„Çø„É≥„Åó„Åç",
                vi: "ki·ªÉu c√≥ n√∫t nh·∫•n",
              },
              { word: "Êäº„Åï„Åà„Çã", kana: "„Åä„Åï„Åà„Çã", vi: "gi·ªØ l·∫°i, ƒë√® gi·ªØ" },
            ],
          },
          {
            id: 11,
            type: "kanji",
            kanji: "Âºè",
            kana: "„Ç∑„Ç≠",
            onyomi: "„Ç∑„Ç≠",
            kunyomi: "",
            meaning: "nghi th·ª©c, ki·ªÉu, c√¥ng th·ª©c",
            exampleJP: "ÂÖ•Â≠¶Âºè„Å´Âá∫Â∏≠„Åô„Çã„ÄÇ",
            exampleVI: "Tham d·ª± l·ªÖ nh·∫≠p h·ªçc.",
            compounds: [
              { word: "Êï∞Âºè", kana: "„Åô„ÅÜ„Åó„Åç", vi: "c√¥ng th·ª©c s·ªë" },
              { word: "ÂÖ•Â≠¶Âºè", kana: "„Å´„ÇÖ„ÅÜ„Åå„Åè„Åó„Åç", vi: "l·ªÖ nh·∫≠p h·ªçc" },
            ],
          },
          {
            id: 12,
            type: "kanji",
            kanji: "‰ø°",
            kana: "„Ç∑„É≥",
            onyomi: "„Ç∑„É≥",
            kunyomi: "",
            meaning: "tin t∆∞·ªüng, t√≠n hi·ªáu",
            exampleJP: "Ëá™ÂàÜ„Çí‰ø°„Åò„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
            exampleVI: "H√£y tin v√†o b·∫£n th√¢n.",
            compounds: [
              { word: "ÈÄÅ‰ø°", kana: "„Åù„ÅÜ„Åó„Çì", vi: "g·ª≠i (t√≠n hi·ªáu, mail)" },
              { word: "Ëá™‰ø°", kana: "„Åò„Åó„Çì", vi: "t·ª± tin" },
              { word: "‰ø°Âè∑", kana: "„Åó„Çì„Åî„ÅÜ", vi: "ƒë√®n t√≠n hi·ªáu" },
              { word: "‰ø°„Åò„Çã", kana: "„Åó„Çì„Åò„Çã", vi: "tin t∆∞·ªüng" },
              { word: "‰ø°Áî®", kana: "„Åó„Çì„Çà„ÅÜ", vi: "t√≠n nhi·ªám" },
            ],
          },
          {
            id: 13,
            type: "kanji",
            kanji: "Âè∑",
            kana: "„Ç¥„Ç¶",
            onyomi: "„Ç¥„Ç¶",
            kunyomi: "",
            meaning: "s·ªë hi·ªáu, k√Ω hi·ªáu",
            exampleJP: "„Åì„ÅÆÂàóËªä„ÅØÔºìÂè∑Ëªä„Åæ„Åß„ÅÇ„Çä„Åæ„Åô„ÄÇ",
            exampleVI: "T√†u n√†y c√≥ t·ªõi toa s·ªë 3.",
            compounds: [
              { word: "„ÄúÂè∑Ëªä", kana: "„Äú„Åî„ÅÜ„Åó„ÇÉ", vi: "toa s·ªë ~ (t√†u)" },
            ],
          },
          {
            id: 14,
            type: "kanji",
            kanji: "Á¢∫",
            kana: "„Ç´„ÇØ",
            onyomi: "„Ç´„ÇØ",
            kunyomi: "„Åü„Åó-„ÅãÔºè„Åü„Åó-„Åã„ÇÅ„Çã",
            meaning: "ch·∫Øc ch·∫Øn, x√°c nh·∫≠n",
            exampleJP: "‰∫àÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
            exampleVI: "H√£y x√°c nh·∫≠n l·∫°i l·ªãch.",
            compounds: [
              { word: "Ê≠£Á¢∫Ôºà„Å™Ôºâ", kana: "„Åõ„ÅÑ„Åã„ÅèÔºà„Å™Ôºâ", vi: "ch√≠nh x√°c" },
              { word: "Á¢∫„ÅãÔºà„Å™Ôºâ", kana: "„Åü„Åó„ÅãÔºà„Å™Ôºâ", vi: "ch·∫Øc ch·∫Øn" },
              { word: "Á¢∫Ë™ç", kana: "„Åã„Åè„Å´„Çì", vi: "x√°c nh·∫≠n" },
              { word: "Á¢∫„Åã„ÇÅ„Çã", kana: "„Åü„Åó„Åã„ÇÅ„Çã", vi: "ki·ªÉm ch·ª©ng" },
            ],
          },
          {
            id: 15,
            type: "kanji",
            kanji: "Ë™ç",
            kana: "„Éã„É≥",
            onyomi: "„Éã„É≥",
            kunyomi: "„Åø„Å®-„ÇÅ„Çã",
            meaning: "c√¥ng nh·∫≠n, ch·∫•p nh·∫≠n",
            exampleJP: "ÂΩº„ÅÆÂä™Âäõ„ÇíË™ç„ÇÅ„Çã„ÄÇ",
            exampleVI: "C√¥ng nh·∫≠n n·ªó l·ª±c c·ªßa anh ·∫•y.",
            compounds: [
              { word: "Ë™ç„ÇÅ„Çã", kana: "„Åø„Å®„ÇÅ„Çã", vi: "th·ª´a nh·∫≠n, ch·∫•p nh·∫≠n" },
            ],
          },
          {
            id: 16,
            type: "kanji",
            kanji: "È£õ",
            kana: "„Éí",
            onyomi: "„Éí",
            kunyomi: "„Å®-„Å∂",
            meaning: "bay",
            exampleJP: "È≥•„ÅåÁ©∫„ÇíÈ£õ„Çì„Åß„ÅÑ„Çã„ÄÇ",
            exampleVI: "Chim ƒëang bay tr√™n tr·ªùi.",
            compounds: [
              { word: "È£õË°åÂ†¥", kana: "„Å≤„Åì„ÅÜ„Åò„Çá„ÅÜ", vi: "s√¢n bay" },
              { word: "È£õ„Å∂", kana: "„Å®„Å∂", vi: "bay" },
            ],
          },
        ];

        /* ===================== BUILD COMPOUND LIST ===================== */
        const compoundItems = [];
        vocabList.forEach((k) => {
          (k.compounds || []).forEach((c, index) => {
            compoundItems.push({
              type: "compound",
              id: `c-${k.id}-${index}`,
              word: c.word,
              kana: c.kana,
              meaning: c.vi,
              parentKanji: k.kanji,
              parentMeaning: k.meaning,
            });
          });
        });

        /* ===================== COMBINED LISTS ===================== */
        const kanjiItems = vocabList; // t·∫•t c·∫£ kanji
        const combinedItems = [...kanjiItems, ...compoundItems];

        /* ===================== QUIZ MODES ===================== */
        const MODE_KANJI_MEANING = "kanji-meaning";
        const MODE_COMPOUND_MEANING = "compound-meaning";
        const MODE_MEANING_TO_ITEM = "meaning-to-item";
        const MODE_READING = "reading";

        const MODE_REVIEW_WRONG = "review-wrong"; // NEW MODE
        /* ===================== HELPERS ===================== */

        // Shuffle array
        function shuffle(arr) {
          return arr
            .map((x) => ({ x, r: Math.random() }))
            .sort((a, b) => a.r - b.r)
            .map((obj) => obj.x);
        }

        // Random pick excluding correct
        function pickRandomOptions(correct, list, count) {
          const filtered = list.filter((i) => i !== correct);
          return shuffle(filtered).slice(0, count);
        }

        // Detect if item is Kanji or Compound
        function isKanji(item) {
          return item.type === "kanji";
        }

        /* ===================== WRONG WORD STORAGE ===================== */

        const WRONG_KEY = "N3_WRONG_LIST";

        // Load wrong list from localStorage
        function loadWrongList() {
          try {
            return JSON.parse(localStorage.getItem(WRONG_KEY)) || [];
          } catch {
            return [];
          }
        }

        // Save wrong list
        function saveWrongList(list) {
          localStorage.setItem(WRONG_KEY, JSON.stringify(list));
        }

        // Add a wrong item (item + mode)
        function addWrongItem(item, mode) {
          const wrongList = loadWrongList();

          // t·∫°o key duy nh·∫•t
          const itemKey = `${item.type}_${item.id}_${mode}`;
          const exists = wrongList.some((x) => x.key === itemKey);

          if (!exists) {
            wrongList.push({
              key: itemKey,
              id: item.id,
              type: item.type,
              mode: mode,
            });
            saveWrongList(wrongList);
          }

          updateWrongCount();
        }

        // Clear all wrong items
        function clearWrongList() {
          localStorage.removeItem(WRONG_KEY);
          updateWrongCount();
        }

        // Update display count
        function updateWrongCount() {
          document.getElementById("wrong-count").textContent =
            loadWrongList().length;
        }

        updateWrongCount();

        /* ===================== REVIEW MODE QUESTION GENERATOR ===================== */

        function generateReviewQuestions() {
          const wrongList = loadWrongList();
          if (wrongList.length === 0) return [];

          // 70% wrong
          const wrongCount = Math.ceil(wrongList.length * 0.7);
          const selectedWrong = shuffle(wrongList).slice(0, wrongCount);

          const wrongItemsMapped = selectedWrong.map((w) => {
            let source;
            if (w.type === "kanji") {
              source = kanjiItems.find((k) => k.id == w.id);
            } else {
              source = compoundItems.find((c) => c.id === w.id);
            }
            return { ...w, item: source };
          });

          // 30% random
          const randomCount = Math.floor(wrongList.length * 0.3);
          const randomPool = shuffle(combinedItems).slice(0, randomCount);

          const randomMapped = randomPool.map((item) => ({
            key: "random_" + Math.random(),
            id: item.id,
            type: item.type,
            mode: pickRandomMode(),
            item: item,
          }));

          return shuffle([...wrongItemsMapped, ...randomMapped]);
        }

        // Random mode for filler questions
        function pickRandomMode() {
          const modes = [
            MODE_KANJI_MEANING,
            MODE_COMPOUND_MEANING,
            MODE_MEANING_TO_ITEM,
            MODE_READING,
          ];
          return modes[Math.floor(Math.random() * modes.length)];
        }
        /* ===================== STATE ===================== */
        let currentMode = MODE_KANJI_MEANING;
        let questionList = [];
        let currentIndex = 0;
        let correctCount = 0;
        let inReviewMode = false;
        let reviewQuestions = [];
        let currentReviewIndex = 0;

        /* ===================== MODE DESCRIPTIONS ===================== */
        const modeDescriptions = {
          [MODE_KANJI_MEANING]:
            "Ch·∫ø ƒë·ªô Kanji ‚Üí Nghƒ©a: Nh√¨n Kanji, ch·ªçn nghƒ©a ƒë√∫ng.",
          [MODE_COMPOUND_MEANING]: "Ch·∫ø ƒë·ªô T·ª´ gh√©p ‚Üí Nghƒ©a.",
          [MODE_MEANING_TO_ITEM]:
            "Ch·∫ø ƒë·ªô Nghƒ©a ‚Üí ch·ªçn Kanji ho·∫∑c T·ª´ gh√©p ph√π h·ª£p.",
          [MODE_READING]: "Ch·∫ø ƒë·ªô ch·ªçn c√°ch ƒë·ªçc (Kana).",
          [MODE_REVIEW_WRONG]:
            "‚≠ê ƒêang ·ªü ch·∫ø ƒë·ªô √îN T·ª™ SAI ‚Äì h·ªèi l·∫°i nh·ªØng m·ª•c b·∫°n tr·∫£ l·ªùi sai.",
        };

        /* ===================== INIT QUIZ ===================== */
        function startQuiz(mode) {
          inReviewMode = false;
          currentMode = mode;
          currentIndex = 0;
          correctCount = 0;

          switch (mode) {
            case MODE_KANJI_MEANING:
              questionList = shuffle(kanjiItems);
              break;
            case MODE_COMPOUND_MEANING:
              questionList = shuffle(compoundItems);
              break;
            case MODE_MEANING_TO_ITEM:
            case MODE_READING:
              questionList = shuffle(combinedItems);
              break;
          }

          updateHeader();
          renderQuestion();
        }

        /* ===================== UPDATE HEADER ===================== */
        function updateHeader() {
          document.getElementById("current-question").textContent =
            currentIndex + 1;
          document.getElementById("total-question").textContent =
            questionList.length;
          document.getElementById("correct-count").textContent = correctCount;
          document.getElementById("mode-hint").textContent =
            modeDescriptions[currentMode];
        }

        /* ===================== BUILD QUESTION OBJECT ===================== */
        function buildQuestion(item, mode) {
          let question = {
            item,
            mode,
            questionText: "",
            displayMain: "",
            reading: "",
            options: [],
            correctAnswer: "",
          };

          if (mode === MODE_KANJI_MEANING) {
            question.displayMain = item.kanji;
            question.questionText = "Ch·ªçn nghƒ©a ƒë√∫ng c·ªßa ch·ªØ Kanji d∆∞·ªõi ƒë√¢y:";
            question.correctAnswer = item.meaning;

            let wrongs = pickRandomOptions(item, kanjiItems, 3).map(
              (i) => i.meaning
            );
            question.options = shuffle([item.meaning, ...wrongs]);
          } else if (mode === MODE_COMPOUND_MEANING) {
            question.displayMain = item.word;
            question.questionText = "Ch·ªçn nghƒ©a ƒë√∫ng c·ªßa t·ª´ gh√©p:";
            question.correctAnswer = item.meaning;

            let wrongs = pickRandomOptions(item, compoundItems, 3).map(
              (i) => i.meaning
            );
            question.options = shuffle([item.meaning, ...wrongs]);
          } else if (mode === MODE_MEANING_TO_ITEM) {
            question.displayMain = item.meaning;
            question.questionText = "Ch·ªçn Kanji / t·ª´ gh√©p t∆∞∆°ng ·ª©ng:";
            question.correctAnswer = isKanji(item) ? item.kanji : item.word;

            let wrongs = pickRandomOptions(item, combinedItems, 3).map((i) =>
              isKanji(i) ? i.kanji : i.word
            );
            question.options = shuffle([question.correctAnswer, ...wrongs]);
          } else if (mode === MODE_READING) {
            question.displayMain = isKanji(item) ? item.kanji : item.word;
            question.questionText = "Ch·ªçn c√°ch ƒë·ªçc ƒë√∫ng (Kana):";
            question.correctAnswer = item.kana;

            let wrongs = pickRandomOptions(item, combinedItems, 3).map(
              (i) => i.kana
            );
            question.options = shuffle([item.kana, ...wrongs]);
          }

          return question;
        }

        /* ===================== RENDER QUESTION ===================== */
        function renderQuestion() {
          if (inReviewMode) {
            if (currentReviewIndex >= reviewQuestions.length) {
              showReviewEnd();
              return;
            }

            const qObj = reviewQuestions[currentReviewIndex];
            const q = buildQuestion(qObj.item, qObj.mode);
            renderQuestionUI(q);
            return;
          }

          if (currentIndex >= questionList.length) {
            showQuizEnd();
            return;
          }

          const q = buildQuestion(questionList[currentIndex], currentMode);
          renderQuestionUI(q);
        }

        /* ===================== RENDER QUESTION TO SCREEN ===================== */
        function renderQuestionUI(q) {
          const display = document.getElementById("quiz-display");
          const options = document.getElementById("quiz-options");
          const feedback = document.getElementById("quiz-feedback");

          display.innerHTML = `
              <div class="kanji-display ${
                q.displayMain.length >= 5 ? "small-text" : ""
              }">${q.displayMain}</div>
              <div class="reading">${q.reading}</div>
              <div class="question-text">${q.questionText}</div>
            `;

          options.innerHTML = "";
          q.options.forEach((opt) => {
            const btn = document.createElement("button");
            btn.className = "option-btn";
            btn.textContent = opt;

            btn.onclick = () => {
              checkAnswer(q, opt, btn);
            };

            options.appendChild(btn);
          });

          feedback.textContent = "";
        }

        /* ===================== CHECK ANSWER ===================== */
        function checkAnswer(q, selected, btn) {
          const feedback = document.getElementById("quiz-feedback");
          const options = document.querySelectorAll(".option-btn");

          options.forEach((b) => (b.disabled = true));

          if (selected === q.correctAnswer) {
            btn.classList.add("correct");
            feedback.textContent = "‚úî Ch√≠nh x√°c!";
            feedback.className = "feedback correct";

            if (!inReviewMode) correctCount++;
          } else {
            btn.classList.add("wrong");
            feedback.textContent = "‚úò Sai r·ªìi!";
            feedback.className = "feedback wrong";

            // L∆∞u t·ª´ sai (ƒë√∫ng mode sai)
            if (!inReviewMode) addWrongItem(q.item, q.mode);
          }

          updateHeader();

          // Next button
          const actions = document.getElementById("quiz-actions");
          actions.innerHTML = `
              <button class="btn btn-primary" id="next-btn">C√¢u ti·∫øp theo ‚Üí</button>
            `;
          document.getElementById("next-btn").onclick = () => nextQuestion();
        }

        /* ===================== NEXT QUESTION ===================== */
        function nextQuestion() {
          const actions = document.getElementById("quiz-actions");
          actions.innerHTML = "";

          if (inReviewMode) {
            currentReviewIndex++;
          } else {
            currentIndex++;
          }

          renderQuestion();
        }

        /* ===================== NORMAL QUIZ END ===================== */
        function showQuizEnd() {
          const display = document.getElementById("quiz-display");
          const options = document.getElementById("quiz-options");
          const actions = document.getElementById("quiz-actions");

          display.innerHTML = `
              <h2>üéâ B·∫°n ƒë√£ ho√†n th√†nh quiz!</h2>
              <p>ƒêi·ªÉm: ${correctCount} / ${questionList.length}</p>
            `;
          options.innerHTML = "";

          actions.innerHTML = `
              <button class="btn btn-primary" onclick="startQuiz(currentMode)">
                L√†m l·∫°i
              </button>
            `;
        }

        /* ===================== REVIEW MODE START ===================== */
        function startReviewMode() {
          const wrongList = loadWrongList();
          if (wrongList.length === 0) {
            alert("Kh√¥ng c√≥ t·ª´ sai n√†o ƒë·ªÉ √¥n l·∫°i!");
            return;
          }

          inReviewMode = true;
          currentMode = MODE_REVIEW_WRONG;

          reviewQuestions = generateReviewQuestions();
          currentReviewIndex = 0;

          document.getElementById("mode-hint").textContent =
            modeDescriptions[MODE_REVIEW_WRONG];

          renderReviewHeader();
          renderQuestion();
        }

        function renderReviewHeader() {
          document.getElementById("current-question").textContent =
            currentReviewIndex + 1;
          document.getElementById("total-question").textContent =
            reviewQuestions.length;
          document.getElementById("correct-count").textContent = "-";
        }

        /* ===================== REVIEW END ===================== */
        function showReviewEnd() {
          const display = document.getElementById("quiz-display");
          const options = document.getElementById("quiz-options");
          const actions = document.getElementById("quiz-actions");

          display.innerHTML = `
              <h2>‚≠ê Ho√†n th√†nh ch·∫ø ƒë·ªô √îN T·ª™ SAI!</h2>
              <p>B·∫°n ƒë√£ xem l·∫°i ${reviewQuestions.length} m·ª•c.</p>
            `;
          options.innerHTML = "";

          actions.innerHTML = `
              <button class="btn btn-primary" onclick="startReviewMode()">
                L√†m l·∫°i Review
              </button>

              <button class="btn btn-outline" onclick="clearWrongList()">
                Xo√° to√†n b·ªô t·ª´ sai
              </button>

              <button class="btn btn-outline" onclick="exitReview()">
                Tho√°t Review
              </button>
            `;
        }
        /* ===================== EXIT REVIEW ===================== */
        function exitReview() {
          inReviewMode = false;
          startQuiz(MODE_KANJI_MEANING);
        }
      </script>

      <!-- QUIZ LAYOUT -->
      <div id="quiz-layout">
        <!-- QUIZ PANEL -->
        <div class="card">
          <div id="quiz-display"></div>
          <div id="quiz-options" class="options"></div>
          <div id="quiz-feedback" class="feedback"></div>
          <div id="quiz-actions" class="actions"></div>
        </div>

        <!-- INFO PANEL -->
        <div id="info-panel" class="card">
          <h2>Th√¥ng tin</h2>
          <div id="info-content">
            H√£y ch·ªçn m·ªôt ƒë√°p √°n ƒë·ªÉ xem th√™m th√¥ng tin.
          </div>
        </div>
      </div>
      <!-- end quiz-layout -->

      <script>
        /* ===================== UPDATE INFO PANEL ===================== */
        function updateInfoPanel(item) {
          const info = document.getElementById("info-content");

          if (!item) {
            info.innerHTML = "H√£y ch·ªçn m·ªôt ƒë√°p √°n ƒë·ªÉ xem th√™m th√¥ng tin.";
            return;
          }

          if (item.type === "kanji") {
            info.innerHTML = `
              <div class="mode-pill">KANJI</div>
              <div class="info-row"><span class="info-label">Ch·ªØ:</span> ${
                item.kanji
              }</div>
              <div class="info-row"><span class="info-label">√Çm On:</span> ${
                item.onyomi
              }</div>
              <div class="info-row"><span class="info-label">√Çm Kun:</span> ${
                item.kunyomi
              }</div>
              <div class="info-row"><span class="info-label">Nghƒ©a:</span> ${
                item.meaning
              }</div>

              <div class="example">
                <b>V√≠ d·ª•:</b><br>
                JP: ${item.exampleJP}<br>
                VI: ${item.exampleVI}
              </div>

              <div style="margin-top:10px;">
                <b>T·ª´ gh√©p:</b>
                <ul class="compound-list">
                  ${item.compounds
                    .map((c) => `<li>${c.word} (${c.kana}) ‚Äì ${c.vi}</li>`)
                    .join("")}
                </ul>
              </div>
            `;
          }

          if (item.type === "compound") {
            info.innerHTML = `
              <div class="mode-pill">T·ª™ GH√âP</div>
              <div class="info-row"><span class="info-label">T·ª´:</span> ${item.word}</div>
              <div class="info-row"><span class="info-label">C√°ch ƒë·ªçc:</span> ${item.kana}</div>
              <div class="info-row"><span class="info-label">Nghƒ©a:</span> ${item.meaning}</div>

              <div style="margin-top:10px;">
                <b>Thu·ªôc kanji:</b> ${item.parentKanji} ‚Äì ${item.parentMeaning}
              </div>
            `;
          }
        }
        // Mode switching
        document.querySelectorAll(".mode-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const mode = btn.dataset.mode;

            document
              .querySelectorAll(".mode-btn")
              .forEach((b) => b.classList.remove("active"));

            btn.classList.add("active");

            startQuiz(mode);
          });
        });

        // Review button
        document.getElementById("review-btn").onclick = () => {
          startReviewMode();
        };

        // INIT
        window.onload = () => {
          startQuiz(MODE_KANJI_MEANING);
        };
        /* ===================== DARK MODE TOGGLE ===================== */
        const darkToggle = document.getElementById("dark-toggle");

        // Load saved mode
        if (localStorage.getItem("dark-mode") === "on") {
          document.body.classList.add("dark");
          darkToggle.textContent = "‚òÄÔ∏è Light Mode";
        }

        darkToggle.onclick = () => {
          document.body.classList.toggle("dark");

          if (document.body.classList.contains("dark")) {
            localStorage.setItem("dark-mode", "on");
            darkToggle.textContent = "‚òÄÔ∏è Light Mode";
          } else {
            localStorage.setItem("dark-mode", "off");
            darkToggle.textContent = "üåô Dark Mode";
          }
        };

        /* =============== AUDIO EFFECTS =============== */

        const soundCorrect = new Audio(
          "https://cdn.jsdelivr.net/gh/zeno-yt/sound-effects/correct.mp3"
        );
        const soundWrong = new Audio(
          "https://cdn.jsdelivr.net/gh/zeno-yt/sound-effects/wrong.mp3"
        );

        soundCorrect.volume = 0.7;
        soundWrong.volume = 0.7;
        /* ===================== PATCH CHECKANSWER (INFO + AUDIO) ===================== */

        const _oldCheckAnswer = checkAnswer;

        checkAnswer = function (q, selected, btn) {
          // G·ªçi h√†m g·ªëc
          _oldCheckAnswer(q, selected, btn);

          // Update b·∫£ng th√¥ng tin
          updateInfoPanel(q.item);

          // √Çm thanh
          setTimeout(() => {
            if (selected === q.correctAnswer) {
              soundCorrect.currentTime = 0;
              soundCorrect.play().catch(() => {});
            } else {
              soundWrong.currentTime = 0;
              soundWrong.play().catch(() => {});
            }
          }, 80);
        };
      </script>
    </div>
  </body>
</html>
